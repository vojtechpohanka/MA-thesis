---
title: "Variation in the salience of cultural issues across parties"
output:
  pdf_document: default
  html_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, 
                      warning = FALSE,
                      fig.showtext=FALSE,
                      fig.align='center')
knitr::opts_knit$set(root.dir = "C:/Users/voyta/Desktop/Thesis")

```

```{r include=FALSE}
library(tidyverse)
library(ggpubr)
library(ggeffects)
library(jtools)
#install.packages("ggExtra")
library(ggExtra)
library(fixest)
library(marginaleffects)
#install.packages("coefplot")
library(coefplot)
library(sandwich)
library(modelsummary)


party_df <- read.csv("data/df_party_coded.csv")

# add lagged DVs 
party_df <- party_df %>% 
  group_by(party)%>% 
  mutate(nat_multi_lag = lag(nat_multi),
         cult_agg_lag = lag(cult_agg)
         ) %>%
  mutate(fam_fact = factor(fam_fact)) ## convert family to factor

party_df <- party_df %>%
  mutate(
  fam_fact = relevel(
    fam_fact, 
    ref = "RADLEFT"
    )
)


# dataset exluding radical right 
party_df_exclude <- party_df %>%
  filter(family != 1)
```

##### OI: Radical right parties should place a higher degree of salience on cultural issues, particularly multiculturalism, nationalism and immigration, compared to other parties.

Association between party families and issue salience, OLS models with country and year fixed-effects:

```{r}
model1 <- feols(cult_agg ~ fam_fact + pervote |factor(country) + year, 
data = party_df)

model2 <- feols(nat_multi ~ fam_fact + pervote |factor(country) + year, 
data = party_df)

modelsummary(list("Salience of cultural issues (aggregate)" = model1,"Salience of multiculturalism" = model2),
             stars = TRUE,
             gof_omit = "R2 Within|R2 Within Adj.",
             coef_rename = c("cult_agg" = "cultural issue (agg) salience",
         "nat_multi" = "multiculturalism salience",
                "fam_factRADLEFT" = "Radical left",
                "fam_factAGRARIAN/CENTER" = "Agrarian center",
                "fam_factRADRT" = "Radical right",
                "fam_factLIB" = "Liberal",
                "fam_factGREEN" = "Green",
                "fam_factSOC" = "Socialist",
                "fam_factCD" = "Christian Democrat",
                "fam_factCON" = "Conservative",
                "fam_factREG" = "Regionalist",
                "fam_factNOFAMILY" = "No family"
             ),
         notes = "Reference category: radical left"
)



```

Coefficient plot:

```{r}
plot_summs(model1, model2,
           omit.coefs = c("Intercept", "pervote"),
           model.names = c("Aggregate cultural issue salience",
                           "Multiculturalism salience")) +
  theme_classic2() + 
  scale_y_discrete(labels = 
                     c("fam_factRADLEFT" = "Radical left",
                "fam_factAGRARIAN/CENTER" = "Agrarian/center",
                "fam_factRADRT" = "Radical right",
                "fam_factLIB" = "Liberal",
                "fam_factGREEN" = "Green",
                "fam_factSOC" = "Socialist",
                "fam_factCD" = "Christian Democrat",
                "fam_factCON" = "Conservative",
                "fam_factREG" = "Regionalist",
                "fam_factNOFAMILY" = "No family")
                ) +
  labs(y = "Party family",
       x = "Coefficient estimate")
```

##### OI: Right-wing parties that do not belong to the radical right should place a higher emphasis on cultural issues compared to left-wing parties.

OLS of party issue salience on left-right position and vote share, excluding radical-right parties from the analysis:

```{r}

model1 <- feols(cult_agg ~ log_rile + pervote |  factor(country) + year, data = party_df_exclude)
model2 <- feols(nat_multi ~ log_rile + pervote | factor(country) + year, data = party_df_exclude)


modelsummary(list("Salience of cultural issues (aggregate)" = model1,"Salience of multiculturalism" = model2),
             stars = TRUE,
             gof_omit = "R2 Within|R2 Within Adj.")
```

Does the association between left-right position and multiculturalism salience differ across countries?

Predictions from OLS models of multiculturalism on left-right position, adjusting for vote share and including year fixed-effects:

```{r}

countries <- c("Bulgaria", "Croatia", "Czech Republic", "Estonia", "Hungary", 
               "Latvia", "Lithuania", "Poland", "Romania", "Slovakia", "Slovenia")

# Function to run regression for a specific country
run_regression <- function(country_name) {
  model <- feols(nat_multi ~ log_rile + pervote | year, 
              data = subset(party_df_exclude, countryname == country_name))
  return(model)
}

# apply function to each country and store models in a named list
models <- setNames(lapply(countries, run_regression), countries)


# get predictions for each country
predictions_list <- map(set_names(countries), function(country) {
  model_pred <- ggpredict(models[[country]], terms = "log_rile") %>%
    as_tibble() %>%  # Ensure it's a tibble
    mutate(countryname = country)  # Add country name for faceting
  return(model_pred)
})

predictions_df <- bind_rows(predictions_list)

# plot predictions
ggplot(predictions_df, aes(x = x, y = predicted)) +
  geom_line(color = "blue", size = 1) +  # Predicted values
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = 0.2) +  # Confidence interval
  facet_wrap(~ countryname, scales = "free_y") +  # Facet by country
  theme_classic2() +
  scale_x_continuous(
    breaks = seq(-2, 2, by = 1)
  ) + 
  labs(y = "predicted multiculturalism salience",
       x = "left-right position")
```

### Radical right success and mainstream parties' issue emphasis

##### OI: The presence of a strong radical right party in the party system is associated with an increased emphasis on cultural issues by mainstream parties, and this association may be conditional on mainstream parties\' left-right positions.

OLS of party issue salience on the vote share of the radical right at previous elections:

```{r include=FALSE}
party_df_rr <- party_df %>% 
  group_by(countryname, year) %>%
  summarize(far_right_vote = sum(pervote[family == 1], na.rm = TRUE), .groups = "drop") %>%
  group_by(countryname) %>%
  mutate(far_right_vote_lag = lag(far_right_vote)) %>%
  ungroup()

party_df_rr <- party_df %>%
  left_join(
    party_df_rr, 
    by = c("countryname", "year"),
    relationship = "many-to-one"
  )

# check coding
party_df_rr %>%
  select(c("countryname","year",
           "partyname","far_right_vote_lag",
           "far_right_vote")) # %>% View()

# remove radical right parties 

party_df_rr <- party_df_rr %>%
  filter(family !=1) 
 

```

```{r}
model1 <-  feols(
  nat_multi ~ far_right_vote_lag + log_rile + pervote | factor(party) + year,
  data = party_df_rr)

modelsummary(models = list("Salience of multiculturalism" = model1),
             stars = TRUE,
             gof_omit = "R2 Within|R2 Within Adj.")
```

Do left and right-wing mainstream parties react differently to radical right success?

```{r}
model1 <-  feols(
  nat_multi ~ far_right_vote_lag*log_rile + pervote | factor(party) + year,
  data = party_df_rr)

ame_results <- slopes(model1)
plot_slopes(model1, variables = "far_right_vote_lag", condition = "log_rile") +
  theme_pubclean() +
  labs(
    y = "Marginal effect of radical right vote
    on multiculturalism salience",
    x = "Left-right position"
  )
  

```



Note: all data are from the Manifesto project dataset: Lehmann, Pola, Simon Franzmann, Denise Al-Gaddooa, Tobias Burst, Christoph Ivanusch, Sven Regel, Felicia Riethmüller, et al. 2024. “Manifesto Project Dataset.” Manifesto Project. https://doi.org/10.25522/MANIFESTO.MPDS.2024A.
