---
title: "Temporal and Country-level analysis"
author: "VojtÄ›ch Pohanka"
date: "2025-02-28"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, 
                      warning = FALSE,
                      fig.showtext=FALSE)
knitr::opts_knit$set(root.dir = "C:/Users/voyta/Desktop/Thesis")

```

# [Empirical tests]{.underline}

```{r}
library(tidyverse)
library(plm)
library(gplots)
library(tseries)
library(huxtable)
library(ggpubr)
library(ggeffects)
library(jtools)
library(ggrepel)

```

```{r data_prep, cache=TRUE, include=FALSE}

df_party <- read.csv("data/df_party_cl.csv") # party level data

df_elect <- read.csv("data/df_elect_cl.csv") # election level data


#long dataset for graphing
df_long <- df_elect %>% 
  pivot_longer(cols = uncod_a:non_econ_all_a,
               names_to = "issue_area",
               values_to = "share")

# category names for later 
df_long <- df_long  %>% 
 mutate(category = fct_recode(issue_area,
                              "Aggregate economic" = "econ_agg_a",
                              "Nationalism, multiculturalism,immigration, and minorities + morality issues" = "nat_multi_mor_a", 
                              
                            "Aggregate cultural" =  "cult_agg_a",
                            "All non-economic" = "non_econ_all_a",
                            "Morality" = "mor_a",
                            "Nationalism, multiculturalism, immigration, and minorities" = "nat_multi_a",
                            "Environment" = "envi_a",
                            "Welfare and labour" = "welf_a",
                            "Economy" = "econ_a", 
                            "EU" = "EU_a"))

df_elect <- df_elect %>% 
  group_by(countryname) %>%
  mutate(election_number = row_number()) %>%
  ungroup()
  
                            
                      
```

## [Salience of cultural vs economic issues]{.underline}

**OI: At the aggregate level of party systems, cultural issues have been relatively less salient than economic issues throughout the whole studied period.**

##### Comparing election means across decades

```{r}
df_long %>% 
  filter(decade != "2020s") %>%
  filter(issue_area %in% c("econ_agg_a", "cult_agg_a")) %>%
  ggplot(aes(x = category, y = share)) + 
  geom_boxplot() +
  geom_point(position = position_jitter(),
             alpha = 0.3) +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) +
  facet_wrap(~decade) +
  theme_pubclean() +
  labs( x= "issue area", y = "share of party system agenda")
  
```

##### Line graph with loess

```{r line_graph, echo=FALSE}


cbbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#0072B2", "#D55E00", "#CC79A7")


df_long %>% 
  filter(issue_area %in% c("welf_a", "econ_a", "nat_multi_a", "EU_a", "envi_a","mor_a")) %>%
  ggplot(aes(x=year, y=share, color = category))+
  geom_smooth(aes(linetype=category),method = "loess", se=T, span =0.8)+
  geom_point(aes(shape = category), alpha = 0.3) +
  scale_color_manual(values = cbbPalette)+
  scale_x_continuous(breaks = seq(1990,2020, by = 5))+
  scale_y_continuous(breaks = seq(0,55, by=5))+
  theme_classic2()+ 
  theme(legend.position = "bottom",
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Development of issue content in CEE", x= "Year", y= "Share of the total agenda (%)")
```

## [Is the salience of cultural issues increasing over time?]{.underline}

**OI: The relative salience of cultural issues is increasing over time in CEE party systems.**

##### OLS regressions of party issue salience, country dummies included

```{r}
m1_y <- lm(nat_multi ~ year + countryname,
         data = df_party)
m2_y <- lm(mor ~ year + countryname,
         data = df_party)

m3_y <- lm(envi ~ year + countryname,
         data = df_party)

m4_y <- lm(EU ~ year + countryname,
         data = df_party)

export_summs(m1_y, m2_y, m3_y, m4_y, robust = T,
             model.names = c("Nationalism, multiculturalism, immigration, minorities",
                        "Morality",
                        "Environment",
                        "EU"), 
             coefs = "year")
```

##### predictions from the models above

```{r}
pred1 <- ggpredict(m1_y, terms = "year")
pred2 <- ggpredict(m2_y, terms = "year")
pred3 <- ggpredict(m3_y, terms = "year")
pred4 <- ggpredict(m4_y, terms = "year")


pred1$model <- "Nationalism, multiculturalism, immigration, minorities"
pred2$model <- "Morality"
pred3$model <- "Environment"
pred4$model <- "EU"


all_preds <- bind_rows(pred1, pred2, pred3, pred4)

# Create faceted plot
ggplot(all_preds, aes(x = x, y = predicted)) +
  geom_line() +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = 0.2) +
  facet_wrap(~ model, scales = "free_y") +
  labs(x = "Year", y = "% of quasisentences") +
  theme_classic()
```

## [Was the migration crisis associated with an increase of multiculturalism salience?]{.underline}

**OI: The period following the migration crisis associated with an increase in the salience of multiculturalism and immigration.**

##### Salience of multiculturalism - elections over time

```{r message=FALSE, warning=FALSE}


points <- df_elect %>% 
  filter(nat_multi_a >= 6) 

df_elect %>% 
  ggplot(aes(x=year, y=nat_multi_a))+
  geom_point(shape = 1) +
  geom_text_repel(data = points,
            aes(label = elect_label),
            alpha= 0.5,
            size = 3) +
  geom_vline(xintercept = 2015, 
             linetype = "dashed") +
  geom_smooth(linetype = "dashed",
              alpha = 0.8,
              se = F,
              color = "grey") +
  annotate("text", x=2015, y=20, label="2015", angle=0) +
  scale_y_continuous(breaks = seq(0,30, by=5))+
  scale_x_continuous(breaks = seq(2000, 2020, by =2),
                     limits = c(2000,2020)) +
  theme_classic2() + 
  theme(legend.position = "none",
        plot.title = element_text(hjust = 0.5)) +
  labs(x= "Year", y= "Share of the total agenda (%)")

```

##### Salience of multiculturalism - by country

```{r}

points <- df_elect %>% 
  filter(nat_multi_a >= 6) 

df_elect %>% 
  ggplot(aes(x=year, y=nat_multi_a))+
  geom_point(shape = 1) +
  geom_line() +
  geom_vline(xintercept = 2015, 
             linetype = "dashed") +
  facet_wrap(~countryname) +
  annotate("text", x=2015, y=20, label="2015", angle=0) +
  scale_y_continuous(breaks = seq(0,40, by=5))+
  scale_x_continuous(breaks = seq(2000, 2020, by =2),
                     limits = c(2000,2020)) +
  theme_classic2() + 
  theme(legend.position = "none",
        axis.text.x = element_text(angle = 90),
        plot.title = element_text(hjust = 0.5)) +
  labs(x= "Year", y= "Share of the total agenda (%)")

```

## [Does the salience of cultural issues differ conditional on ethnic minorities, religion, or communist legacies?]{.underline}

**OI: The salience of multiculturalism should be higher in countries that have politically significant ethnic minorities**

**BUT also in those that have a legacy of national accomodative communism**

##### General plots

```{r}

df_long %>% 
  filter(issue_area %in% c("nat_multi_a", "mor_a")) %>%
  ggplot(aes(x=year, y=share, color = category))+
  geom_smooth(aes(linetype=category),method = "loess", se=T, span =0.8)+
  geom_point(aes(shape = category), alpha = 0.3) +
  scale_color_manual(values = cbbPalette)+
  scale_y_continuous(breaks = seq(0,30, by=5))+
  theme_classic2()+ 
  theme(legend.position = "bottom",
         axis.text.x = element_text(angle = 90),
        plot.title = element_text(hjust = 0.5)) +
  facet_wrap(~countryname)+
  labs(title = "Development of issue content in CEE - two categories",
    x= "Year", y= "Share of the total agenda (%)")


```

```{r}
df_elect %>%
  ggplot(aes(x=year, y= cult_agg_a))+
  geom_smooth(method = "loess", se=T, span =0.8)+
  geom_point(shape = 1, alpha = 0.3) +
  scale_y_continuous(breaks = seq(0,30, by=5))+
  theme_classic2()+ 
  theme(legend.position = "bottom",
         axis.text.x = element_text(angle = 90),
        plot.title = element_text(hjust = 0.5)) +
  facet_wrap(~countryname)+
  labs(title = "Development of issue content in CEE - Aggregate cultural issues", x= "Year", y= "Share of the total agenda (%)")
```

##### Differences in election means - multiculturalism

```{r echo=FALSE}


df_elect %>%
  ggplot(aes(x = as.factor(minority_legacy), y = nat_multi_a)) +
  geom_boxplot() + 
  scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) +
  geom_point(position = position_jitter(),
             alpha = 0.3,
             shape = 1) +
  geom_text_repel(aes(label = elect_label),
            alpha = 0.3)+
  labs(y = "% of total agenda", 
       x = "ethnic minority presence and legacy")+
  theme_pubclean()

```

```{r eval=FALSE, include=FALSE}

# Party-level differences in multiculturalism
df_party %>%
  ggplot(aes(x = as.factor(minority_legacy), y = nat_multi)) +
  geom_boxplot() + 
  geom_point(position = position_jitter(),
             alpha = 0.3,
             shape = 1) +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) +
  scale_y_continuous(breaks = seq(0,60, by = 10))+
  labs(y = "% of quasisentences", 
       x = "ethnic minority presence and legacy")+
  theme_pubclean()

```

##### Religion and the salience of morality issues

**OI: Countries' religiosity levels are positively associated with the salience of cultural issues, especially those related to morality.**

```{r}
df_elect %>% 
  ggplot(aes(x = share_rel, y = mor_a)) +
  geom_point() +
  geom_text_repel(aes(label = elect_label),
                  alpha = 0.3,
                  size = 3)+
  theme_pubclean() +
  labs(y = "% of total agenda",
       x = "population religious share
                (ESS trend file)")
```
